\chapter{Data and Simulated Samples}\label{sec:data}

The data sample used for the CMS Run 2 \hzg{} search corresponds to a total integrated luminosity of \LumiT\fbinv and was collected over a data-taking period spanning three years: \Lumia\fbinv in 2016, \Lumib\fbinv in 2017, and \Lumic\fbinv in 2018~\cite{CMS-LUM-17-003,LUM-17-004,LUM-18-002}. 
To be considered in the analysis, events must satisfy the HLT requirements for at least one of the dielectron or dimuon triggers.
The dielectron trigger requires a leading (subleading) electron with
$\pt > 23\,(12)\GeV$, while the dimuon trigger requires a leading (subleading) muon with $\pt > 17\,(8)\GeV$.
The corresponding CMS data streams are listed in Table \ref{tab:data_samples}. All data samples use the CMS MINIAOD data format.
To ensure data quality, luminosity masks are applied based on recommendations from the Physics Performance and Dataset group.

\begin{table}[tb]
  \begin{center}
	  \caption{Summary of MINIAOD data samples used.}
    \begin{tabular}{|l|l|}
      \hline
	    \textbf{$\Pe^+\Pe^-\PGg$ final state} & \textbf{$\PGm^+\PGm^+\PGg$ final state}	                     \\\hline 
      /DoubleEG/Run2016B-17Jul2018\_ver2-v1 	&  /DoubleMuon/Run2016B-17Jul2018\_ver2-v1   \\
      /DoubleEG/Run2016C-17Jul2018-v1 		&  /DoubleMuon/Run2016C-17Jul2018-v1         \\
      /DoubleEG/Run2016D-17Jul2018-v1 		&  /DoubleMuon/Run2016D-17Jul2018-v1         \\
      /DoubleEG/Run2016E-17Jul2018-v1	        &  /DoubleMuon/Run2016E-17Jul2018-v1         \\       
      /DoubleEG/Run2016F-17Jul2018-v1	        &  /DoubleMuon/Run2016F-17Jul2018-v1         \\       
      /DoubleEG/Run2016G-17Jul2018-v1	        &  /DoubleMuon/Run2016G-17Jul2018-v1         \\
      /DoubleEG/Run2016H-17Jul2018-v1	        &  /DoubleMuon/Run2016H-17Jul2018-v1         \\
      /DoubleEG/Run2016H-17Jul2018-v1	        &  /DoubleMuon/Run2016H-17Jul2018-v1         \\
      /DoubleEG/Run2017B-31Mar2018-v1	        &  /DoubleMuon/Run2017B-31Mar2018-v1         \\
      /DoubleEG/Run2017C-31Mar2018-v1	        &  /DoubleMuon/Run2017C-31Mar2018-v1         \\
      /DoubleEG/Run2017D-31Mar2018-v1	        &  /DoubleMuon/Run2017D-31Mar2018-v1         \\
      /DoubleEG/Run2017E-31Mar2018-v1	        &  /DoubleMuon/Run2017E-31Mar2018-v1         \\       
      /DoubleEG/Run2017F-31Mar2018-v1	        &  /DoubleMuon/Run2017F-31Mar2018-v1         \\           
      /EGamma/Run2018A-17Sep2018-v2		&  /DoubleMuon/Run2018A-17Sep2018-v2         \\  
      /EGamma/Run2018B-17Sep2018-v1		&  /DoubleMuon/Run2018B-17Sep2018-v1         \\
      /EGamma/Run2018C-17Sep2018-v1		&  /DoubleMuon/Run2018C-17Sep2018-v1         \\
      /EGamma/Run2018D-22Jan2019-v2		&  /DoubleMuon/Run2018D-PromptReco-v2        \\\hline       
    \end{tabular}
    \label{tab:data_samples}
  \end{center}
\end{table}

Signal samples for $\Pg\Pg\PH$, VBF, $\mathrm{V}\PH$, and $\ttbar\PH$ production, with 
$\PH\to\PZ\gamma$ and $\PZ\to\ell^+\ell^-$ ($\ell = \Pe$, $\mu$, or $\tau$),
are generated at next-to-leading order (NLO) using \POWHEG v2.0~\cite{cite:powheg1,cite:powheg2}.
These samples are produced for $m_\PH$ of $120$, $125$, and $130$\GeV. 
The dominant backgrounds, $\PZ/\gamma^{*}(\rightarrow \ell^+\ell^-)$+$\gamma$ and $\PZ/\gamma^{*}(\rightarrow \ell^+\ell^-)$+jets,
are generated at NLO using the \MGvATNLO v2.6.0 (v2.6.1) 
generator~\cite{Alwall:2014hca} for 2016 (2017 and 2018) samples. 
 Events arising from $\ttbar$ production~\cite{Frixione:2007nw} are a relatively minor background and are generated at NLO with \POWHEG v2.0~\cite{cite:powheg1,cite:powheg2}.
 The background from vector boson scattering (VBS) production of $\PZ/\gamma^{*}$+$\gamma$ pairs, with the $\PZ$ boson decaying to a pair of leptons, is simulated at leading order using the \MGvATNLO generator. The decay $\PH\to\mu^+\mu^-$ is considered as a resonant background and is generated for the $\Pg\Pg\PH$, VBF,  $\mathrm{V}\PH$, and $\ttbar\PH$ production mechanisms. The $\Pg\Pg\PH$ production cross section is
computed at next-to-next-to-NLO precision in QCD and at NLO in electroweak (EWK)
theory~\cite{Anastasiou:2016cez}. 
The cross sections for Higgs boson production in the VBF~\cite{PhysRevLett.115.082002} and VH~\cite{BREIN2004149} mechanisms are calculated at next-to-NLO in QCD, including NLO EWK corrections, while the $\ttbar\PH$ cross section is computed at NLO in QCD and EWK theory~\cite{PhysRevD.68.034022}. 

A full list of simulated physics processes used in the analysis is provided in Table \ref{tab:sim_samples}, along with cross section and branching fraction information. 
For the \hzg{} and $\PH\to\mu^+\mu^-$ samples, the SM Higgs boson production cross sections and branching fractions
recommended by the LHC Higgs Working
Group~\cite{LHC-YR4} are used for each mass point.
The values for the Higgs boson processes listed in Table \ref{tab:sim_samples} correspond to $m_{\PH}=125\GeV$.

\begin{table}[tb]
	\begin{center}
		\caption{Simulated event samples used in the analysis. For Higgs samples, the listed cross sections and branching fractions correspond to the values for $m_{\PH}=125\GeV$.}
		\begin{tabular}{|l|c|c|}
			\hline
			\textbf{process} & \textbf{cross section (pb)} & \textbf{branching fraction}\\\hline 
			$\mathrm{gg}\PH\to\PZ\gamma\to\lplm\gamma$ & 48.58 & $1.548\times 10^{-3}$ \\ 
			$\mathrm{q\bar{q}}\PH\to\PZ\gamma\to\lplm\gamma$ & 3.782 & $1.548\times 10^{-3}$\\
			$\PZ\PH\to\PZ\gamma\to\lplm\gamma$ & 0.8839 & $1.548\times 10^{-3}$\\ 
			$\PW^+\PH\to\PZ\gamma\to\lplm\gamma$ & 0.84 & $1.548\times 10^{-3}$\\
			$\PW^-\PH\to\PZ\gamma\to\lplm\gamma$ & 0.532 & $1.548\times 10^{-3}$\\ 
			$\ttbar\PH\to\PZ\gamma\to\lplm\gamma$ & 0.5071 & $1.548\times 10^{-3}$\\ 
			$\mathrm{gg}\PH\to\mpmm$ & 48.58 & $2.176\times 10^{-4}$\\ 
			$\mathrm{q\bar{q}}\PH\to\mpmm$ & 3.782 & $2.176\times 10^{-4}$\\
			$\PZ\PH\to\mpmm$ & 0.8839 & $2.176\times 10^{-4}$\\ 
			$\PW^+\PH\to\mpmm$ & 0.84 & $2.176\times 10^{-4}$\\
			$\PW^-\PH\to\mpmm$ & 0.532 & $2.176\times 10^{-4}$\\ 
			$\ttbar\PH\to\mpmm$ & 0.5071 & $2.176\times 10^{-4}$\\ 
			$\PZ/\gamma^*\to\lplm\gamma$ & 117.864 & --\\
			$\PZ/\gamma^*\to\lplm$+jets & 6225.42 & --\\
			$\ttbar$ (inclusive) & 831.76 & --\\
			VBF $\PZ/\gamma^*+\gamma$ & 0.1097 & --\\

			\hline
		\end{tabular}
		\label{tab:sim_samples}
	\end{center}
\end{table}

All simulated events are interfaced
with \PYTHIA v8.226~(v8.230)~\cite{Sjostrand:2014zea} with the
CUETP8M1~\cite{Khachatryan:2015pea} (CP5~\cite{Sirunyan:2019dfx}) underlying event tune for 2016 (2017--2018) for the
fragmentation and hadronization of partons and the internal bremsstrahlung of the leptons. The NLO parton distribution function (PDF) set, NNPDF v3.0~\cite{nnpdf30}~(NNPDF v3.1)~\cite{nnpdf_new}, is used to produce these samples in 2016 (2017--2018). The response of the CMS detector is modeled using the
\GEANTfour  program~\cite{AGOSTINELLI2003250}. 
The simulated events are reweighted to correct for differences between data and simulation in the number of additional $\Pp\Pp$ interactions, trigger efficiencies, selection efficiencies, and efficiencies of isolation requirements for photons, electrons, and muons. These corrections and their associated uncertainties will be described in more detail throughout the remainder of this thesis. The rest of this chapter will discuss general procedures and corrections related to the data and simulated samples.

\section{Z+jets Overlap Removal}
The two dominant backgrounds in this analysis are $\PZ/\gamma^{*}(\rightarrow \ell^+\ell^-)$+$\gamma$, or $\PZ\gamma$ for short, and $\PZ/\gamma^{*}(\rightarrow \ell^+\ell^-)$+jets, or $\PZ$+jets for short. Both processes 
are simulated independently in order to obtain the best model of the kinematics of the $\lplm\gamma$ system. 
The $\PZ\gamma$ sample simulates photons from initial-state and final-state radiation at the matrix element level and includes a better 
computation of the interference between the corresponding Feynman diagrams than the $\PZ$+jets sample.
However, the $\PZ$+jets
simulated sample also includes the contribution from $\PZ\gamma$. Therefore, this contribution must be removed from the 
$\PZ$+jets sample in order to avoid double counting events and to utilize the better kinematic modeling of the $\PZ\gamma$
sample. To handle this, $\PZ$+jets events are removed from the analysis if they contain prompt, final state photons within 
$\DR = \sqrt{\smash[b]{(\Delta\phi)^2 + (\Delta\eta)^2}} = 0.1$ of the photon selected to reconstruct the $\lplm\gamma$ system.
The events with prompt, final state photons are tagged using generator-level truth information.

\section{Photon Internal Conversion}
\label{sec:gconversion}
The PYTHIA 8 showering algorithm automatically 
includes a component in which $\PH\to\PGg\PGg$ photons are 
internally converted via the process $\PH\to\PGg\PGg*\to \mathrm{f\bar{f}}\PGg\PGg$, with $\mathrm{f\bar{f}}$ mostly $\epem$. 
This also affects the $\PH\to \PZ\PGg$ signal and $\PZ\PGg$ background samples. 
Since the normalization of these samples does not include the internal conversion component, the cross section must be adjusted accordingly.
To determine the amount by which the cross section is adjusted, we measure the internal conversion
rate in simulation. 
We define a ratio where the numerator is the number of events with hard process final state photons
and the denominator is total number of events in the simulation. Subtracting this ratio from unity gives the internal conversion rate.
The hard process final state photon flagging is done using generator-level truth information.
In our analysis, the internal conversion rate is about 3.1\% (2016) and 3.0\% (2017 and 2018).  
We, therefore, divide the affected sample cross sections by 0.969 (0.97) for 2016 (2017 and 2018).

\section{Transverse Momentum Reweighting}\label{sec:Zpt}
For the 2016 MC, the underlying event tuning was developed in Run-1 with 7 \TeV data. 
To get a more appropriate underlying description, the GEN group provided a new tuning
for 2017 and 2018 MC production, updating from CUETP8M1 (2016) to CP5 (2017/2018).
However, a discrepency was found in the $\ell\ell\gamma$ \pt spectrum
which had an obvious and significant impact in the SM $Z\gamma$ sample. 
Since $\pt^{ll\gamma}/m_{ll\gamma}$ is an important variable in the kinematic MVA training, 
we correct for this issue by reweighting the $\pt^{ll\gamma}$ from simulation to data in 
2017 and 2018 using a sideband region. 
We define the sideband region as $115GeV<m_{ll\gamma}<120GeV$ and $130GeV<m_{ll\gamma}<135GeV$,
which is chosen close to signal region to avoid differences in kinematics.
We evaluate this weight for the electron and muon channels for 2017 and 2018.
\begin{figure*}[htbp]
	\begin{center}
		\includegraphics[width=0.35\textwidth]{fig/zpt_reweight/zgptrewei_datasb17.pdf}
		\includegraphics[width=0.35\textwidth]{fig/zpt_reweight/zgptrewei_datasb18.pdf}
	\end{center}
	\caption{Simulation before and after the correction to the $\ell\ell\gamma$ \pt.
    The black points show the data. Left:2017, right: 2018.}
\end{figure*}

\section{Pileup Reweighting}\label{sec:pileup}
The simulation includes an accurate distribution of the number of interactions 
taking place in each bunch crossing. Although the Deterministic Annealing primary vertex reconstruction \cite{detanneal} has been shown to
be efficient and well-behaved up to the observed levels of pileup, the final distribution
for the number of reconstructed primary vertices is still sensitive to differences between data and 
MC in the primary vertex reconstruction and underlying event.
Additionally, there is a potentially larger effect where the distribution for the number of
reconstructed vertices can be biased by the offline event selection criteria and even by the trigger.
In order to factorize these effects, instead of reweighting the MC by the number of 
reconstructed Primary Vertices, we reweight the number of pileup interactions in the simulation 
(as stored in the PileupInfo collection in the MC). The pileup distribution for data is
derived by using the per-bunch-crossing-per-luminosity-section instantaneous luminosity from
the LumiDB together with the total pp inelastic cross section. The total pp inelastic cross 
section is taken to be 66 mb, 72.4 mb, and 80 mb for 2016, 2017, and 2018 respectively.
This yields an expected pileup distribution, correctly weighted by the 
per-bunch-crossing-per-luminosity-section integrated luminosity over the entire data-taking period. The inelatistic cross-sections are choosing the  
Figure \ref{fig:puwei} shows the number of primary vertices distribution after 
pile-up reweighting in
the $ee\PGg$ channel. 
\begin{figure}[hbtp]
  \begin{center}
     \includegraphics[width=0.3\textwidth]{fig/pileup/ele_kin_nVtx_valid_Legacy16_HLT.pdf}
     \includegraphics[width=0.3\textwidth]{fig/pileup/ele_kin_nVtx_valid_Rereco17_HLT.pdf}
     \includegraphics[width=0.3\textwidth]{fig/pileup/ele_kin_nVtx_valid_Rereco18_HLT.pdf}
  \end{center}
\caption{Distribution of the number of primary vertices in data and simulation shown for the electron channel after 2 leptons and 1 photon are selected. Left to right: 2016, 2017, 2018. The pileup cross section is taken to be 66 mb, 72.4 mb, and 80 mb for 2016, 2017, and 2018 respectively.}
\label{fig:puwei}
\end{figure}

\section{Level-1 Trigger Prefiring Problem}\label{sec:L1}
In 2016 and 2017, a gradual timing shift of the ECAL was not properly propagated to 
L1 trigger primitives (TP) resulting in a significant fraction of high eta TP 
being mistakenly associated to the previous bunch crossing. 
Since Level 1 rules forbid two consecutive bunch crossings to fire, 
an unpleasant consequence of this (in addition to not finding the TP in the bx 0) 
is that events can self veto if a significant amount of ECAL energy is found in the region 
of $2.<|\eta|<3$. This effect is not described by the simulations \cite{L1_prefire}.\\

The JETMET twiki provides a recipe to compute the probability for an event not to prefire, that can then be applied to the simulations. This is achieved with an EDProducer that runs over all offline photons and jets found in the event and assign them a prefiring probability. 

The final event weight is obtained as the product of the non prefiring probability of all objects (measured using unprefirable events), namely:
\begin{equation}
	\omega = 1 - P(Prefiring) = \prod_{i=photon,jets}(1-\epsilon_i^{pref}(\eta,\pt^{EM}))
\end{equation}

The impact of the L1 prefiring for electrons (muons) is a 1.4 (0.8)\% 
loss in signal yield for 2016 and 2.4 (1.1)\% 
loss in signal yield for 2017.

